---
name: publish-story
description: Publish a story to GitHub Pages with preamble, prompt, and copyright
disable-model-invocation: true
argument-hint: -d <story-directory> [options]
---

Publish a story from the given directory to GitHub Pages.

## Steps

1. Run the publish script to assemble both page versions:
   ```
   bash scripts/publish_story.sh $ARGUMENTS
   ```
2. Verify the generated files in `pages/` look correct (preamble at top, copyright at bottom of full version; Medium version uses `layout: null` for plain HTML with no theme, starts with title and subtitle, and has no copyright).
3. Stage and commit the changed files under `pages/` and any modified source files.
4. Push to origin.
5. Watch the GitHub Actions deployment with `gh run watch` until it succeeds.
6. Verify the live pages by checking for expected content with `curl -s`.

## Audio

If the story directory contains an `.m4a` audio file (generated by the `story-to-audio` skill), the publish script automatically:
- Copies the audio file into `pages/`
- Embeds an HTML5 `<audio>` player in the full version, between the preamble/prompt and the story content
- The Medium version does **not** include the audio player

## Featured Image

If the story directory contains a `.png` file with the same basename as the story (e.g., `the_confabulators_gambit.png` for `the_confabulators_gambit.md`), the publish script automatically:
- Copies the PNG into `pages/`
- Includes the image in the Medium version after the subtitle (for use as the Medium featured image)

## Index

The publish script automatically updates `pages/index.md`:
- If the story is already listed (matched by its basename link), the existing entry is updated with the current title and tagline
- If the story is new, an entry is appended to the end of the index
- Each entry links to the full version and the Medium version

## Important

- Never include Co-Authored-By lines or any AI branding in commits.
- The story directory (e.g., `gambit`) must contain the story `.md` file and a `story-prompt.md`.
- Common files `common/preamble.md` and `common/LICENSE-CC-BY-NC-4.0.md` must exist.
